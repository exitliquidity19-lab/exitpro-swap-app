<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>EXIT PRO Swap - Neon Edition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <script src="https://unpkg.com/bs58@latest/index.js"></script>
  <style>
    :root {
      --neon-green: #00ff9d;
      --deep-black: #050505;
    }
    body { 
      background: radial-gradient(circle at center, #0a2a1f 0%, #050505 100%); 
      color: #e0fef4; 
      margin:0; padding:0; 
      min-height:100vh; 
      font-family: 'Segoe UI', system-ui, sans-serif;
      overflow-x: hidden;
    }
    /* Card Style */
    .glass-card {
      background: rgba(0, 20, 15, 0.8);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(0, 255, 157, 0.3);
      border-radius: 24px;
      box-shadow: 0 0 20px rgba(0, 255, 157, 0.1);
    }
    .neon-green-text { color: var(--neon-green); text-shadow: 0 0 8px rgba(0, 255, 157, 0.6); }
    .neon-border { border: 1px solid var(--neon-green); box-shadow: 0 0 10px rgba(0, 255, 157, 0.2); }
    
    /* Button Style */
    .swap-btn {
      background: var(--neon-green);
      color: #000;
      box-shadow: 0 0 15px rgba(0, 255, 157, 0.4);
      transition: all 0.3s ease;
    }
    .swap-btn:hover:not(:disabled) { 
      box-shadow: 0 0 25px rgba(0, 255, 157, 0.7);
      transform: translateY(-1px);
    }
    .connect-btn {
      border: 1px solid var(--neon-green);
      color: var(--neon-green);
      background: rgba(0, 255, 157, 0.05);
    }
    .connect-btn:hover {
      background: var(--neon-green);
      color: #000;
    }

    /* Input & Select */
    .token-select {
      background: rgba(0, 40, 30, 0.6);
      border: 1px solid rgba(0, 255, 157, 0.4);
      color: var(--neon-green);
    }
    input::placeholder { color: rgba(0, 255, 157, 0.3); }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #050505; }
    ::-webkit-scrollbar-thumb { background: var(--neon-green); border-radius: 10px; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <nav class="fixed top-0 w-full glass-card z-50 px-4 py-4 flex justify-between items-center border-b border-[#00ff9d]/20">
    <div class="flex items-center gap-3">
      <img src="assets/logo.png" alt="EXIT PRO" class="h-10 w-10 rounded-full object-cover border-2 border-[#00ff9d]" onerror="this.src='https://via.placeholder.com/40/00ff9d/000?text=E';" />
      <span class="text-2xl font-bold neon-green-text">EXIT PRO</span>
    </div>
    <button id="connect-btn" class="px-6 py-2 connect-btn rounded-full font-bold transition text-sm">
      Connect Wallet
    </button>
  </nav>

  <main class="flex-1 flex items-center justify-center pt-24 pb-12 px-4">
    <div class="glass-card p-8 w-full max-w-md border-t-4 border-t-[#00ff9d]">
      <h1 class="text-3xl font-black text-center neon-green-text mb-8 uppercase tracking-widest">Swap</h1>

      <div class="mb-6">
        <div class="flex justify-between text-xs font-bold text-[#00ff9d]/70 mb-2 uppercase">
          <span>You Pay</span>
          <span id="from-balance">Balance: --</span>
        </div>
        <div class="flex items-center gap-3 bg-black/40 border border-[#00ff9d]/30 rounded-2xl p-4 focus-within:border-[#00ff9d]">
          <input id="from-amount" type="number" placeholder="0.0" class="flex-1 bg-transparent outline-none text-3xl text-white font-medium" />
          <select id="from-token" class="token-select rounded-xl px-3 py-2 font-bold outline-none">
            <option value="So11111111111111111111111111111111111111112">SOL</option>
            <option value="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">USDC</option>
          </select>
        </div>
      </div>

      <div class="flex justify-center -my-6 z-10 relative">
        <div class="bg-[#050505] border border-[#00ff9d]/50 p-2 rounded-full neon-green-text">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
        </div>
      </div>

      <div class="mb-8 mt-4">
        <div class="flex justify-between text-xs font-bold text-[#00ff9d]/70 mb-2 uppercase">
          <span>You Receive</span>
          <span id="to-balance">Balance: --</span>
        </div>
        <div class="flex items-center gap-3 bg-black/40 border border-[#00ff9d]/30 rounded-2xl p-4">
          <input id="to-amount" type="text" placeholder="0.0" readonly class="flex-1 bg-transparent outline-none text-3xl text-white/50 font-medium" />
          <select id="to-token" class="token-select rounded-xl px-3 py-2 font-bold outline-none">
            <option value="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">USDC</option>
            <option value="So11111111111111111111111111111111111111112">SOL</option>
          </select>
        </div>
      </div>

      <div class="text-[11px] font-bold text-[#00ff9d]/50 mb-6 space-y-2 uppercase tracking-tighter">
        <div class="flex justify-between border-b border-[#00ff9d]/10 pb-1">
          <span>Price Impact</span>
          <span id="price-impact" class="text-white">--</span>
        </div>
        <div class="flex justify-between border-b border-[#00ff9d]/10 pb-1">
          <span>Slippage</span>
          <span class="text-white">0.5%</span>
        </div>
        <div class="flex justify-between">
          <span>Route</span>
          <span id="route" class="text-white truncate ml-4">--</span>
        </div>
      </div>

      <button id="swap-btn" disabled class="w-full swap-btn font-black text-xl py-5 rounded-2xl uppercase tracking-widest disabled:opacity-20 disabled:cursor-not-allowed">
        Execute Swap
      </button>

      <div id="status" class="mt-6 text-center text-xs font-bold text-white uppercase tracking-widest min-h-[1.5rem]"></div>
    </div>
  </main>

  <script>
    // --- SEMUA LOGIKA JAVASCRIPT TETAP SAMA SEPERTI VERSI SEBELUMNYA ---
    const JUPITER_API = 'https://quote-api.jup.ag/v6';
    const REFERRAL_ACCOUNT = '9HdCWUEgEajC47Hni4YvUFdoCzvncsMscXixMsmhNYmH';
    const REFERRAL_FEE_BPS = 50;

    let walletPublicKey = null;
    let currentWallet = null;
    let quoteData = null;
    let debounceTimer = null;

    document.getElementById('connect-btn').onclick = async () => {
      let wallet = null;
      if (window.backpack) wallet = window.backpack;
      else if (window.solflare) wallet = window.solflare;
      else if (window.solana) wallet = window.solana;

      if (!wallet) {
        alert('Wallet not found! Use In-App Browser.');
        return;
      }

      try {
        const resp = await wallet.connect();
        const pubKeyObj = resp?.publicKey || wallet.publicKey;
        if (!pubKeyObj) throw new Error('No Public Key');

        walletPublicKey = pubKeyObj.toString();
        currentWallet = wallet;

        const shortKey = `${walletPublicKey.slice(0,4)}...${walletPublicKey.slice(-4)}`;
        document.getElementById('connect-btn').textContent = shortKey;
        document.getElementById('swap-btn').disabled = false;
        document.getElementById('status').textContent = 'READY TO EXIT';
        
        updateBalance();
      } catch (err) {
        alert('Error: ' + err.message);
      }
    };

    async function updateBalance() {
      if (!walletPublicKey) return;
      try {
        const connection = new solanaWeb3.Connection('https://api.mainnet-beta.solana.com');
        const balance = await connection.getBalance(new solanaWeb3.PublicKey(walletPublicKey));
        document.getElementById('from-balance').textContent = `BAL: ${(balance / 1e9).toFixed(3)} SOL`;
      } catch (e) {}
    }

    async function getQuote() {
      const amountInput = document.getElementById('from-amount').value;
      if (!amountInput || amountInput <= 0 || !walletPublicKey) return;

      const inputMint = document.getElementById('from-token').value;
      const outputMint = document.getElementById('to-token').value;
      const decimals = inputMint === 'So11111111111111111111111111111111111111112' ? 1e9 : 1e6;
      const amount = Math.floor(amountInput * decimals);

      document.getElementById('status').textContent = 'CALCULATING...';

      try {
        const url = `${JUPITER_API}/quote?inputMint=${inputMint}&outputMint=${outputMint}&amount=${amount}&slippageBps=50&referralFeeBps=${REFERRAL_FEE_BPS}&referralAccount=${REFERRAL_ACCOUNT}`;
        const res = await fetch(url);
        quoteData = await res.json();

        const outDecimals = outputMint === 'So11111111111111111111111111111111111111112' ? 1e9 : 1e6;
        document.getElementById('to-amount').value = (quoteData.outAmount / outDecimals).toFixed(6);
        document.getElementById('price-impact').textContent = quoteData.priceImpactPct ? (quoteData.priceImpactPct * 100).toFixed(2) + '%' : '--';
        document.getElementById('route').textContent = quoteData.routePlan?.map(r => r.ammLabel).join(' > ') || '--';
        document.getElementById('status').textContent = 'OPTIMIZED';
      } catch (err) {
        document.getElementById('status').textContent = 'QUOTE ERROR';
      }
    }

    document.getElementById('from-amount').addEventListener('input', () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(getQuote, 800);
    });

    document.getElementById('swap-btn').onclick = async () => {
      if (!walletPublicKey || !quoteData || !currentWallet) return;
      document.getElementById('status').textContent = 'WAITING FOR APPROVAL...';

      try {
        const res = await fetch(`${JUPITER_API}/swap`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            quoteResponse: quoteData,
            userPublicKey: walletPublicKey,
            wrapAndUnwrapSol: true,
            referralAccount: REFERRAL_ACCOUNT,
            referralFeeBps: REFERRAL_FEE_BPS,
            dynamicComputeUnitLimit: true,
            prioritizationFeeLamports: 'auto'
          })
        });

        const { swapTransaction } = await res.json();
        const txBuf = Uint8Array.from(atob(swapTransaction), c => c.charCodeAt(0));
        const transaction = solanaWeb3.VersionedTransaction.deserialize(txBuf);

        const signedTx = await currentWallet.signTransaction(transaction);
        const connection = new solanaWeb3.Connection('https://api.mainnet-beta.solana.com', 'confirmed');
        const txid = await connection.sendRawTransaction(signedTx.serialize(), { skipPreflight: true });

        document.getElementById('status').innerHTML = `<a href="https://solscan.io/tx/${txid}" target="_blank" style="color:#00ff9d">DONE! VIEW TX</a>`;
      } catch (err) {
        document.getElementById('status').textContent = 'FAILED';
      }
    };
  </script>
</body>
</html>
 
