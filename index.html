<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>EXIT PRO Swap - Raydium Style</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <style>
    :root { --neon-green: #00ff9d; }
    body { 
      background: #090909; 
      color: #e0fef4; 
      font-family: 'Inter', sans-serif;
    }
    .raydium-card {
      background: #131a1a;
      border: 1px solid rgba(0, 255, 157, 0.1);
      border-radius: 20px;
    }
    .token-box {
      background: #1b2424;
      border: 1px solid transparent;
      transition: all 0.2s;
    }
    .token-box:focus-within { border-color: var(--neon-green); }
    .neon-text { color: var(--neon-green); text-shadow: 0 0 10px rgba(0, 255, 157, 0.3); }
    
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .switch-btn:hover { transform: rotate(180deg); color: var(--neon-green); }
  </style>
</head>
<body class="flex flex-col min-h-screen items-center justify-center px-4">

  <nav class="fixed top-0 w-full flex justify-between items-center p-6 bg-[#090909]/80 backdrop-blur-md z-50">
    <div class="flex items-center gap-2">
      <div class="w-8 h-8 rounded-full border border-[#00ff9d] bg-black"></div>
      <span class="font-black text-lg tracking-tighter neon-text">EXIT PRO</span>
    </div>
    <button id="connect-btn" class="px-4 py-2 bg-[#00ff9d]/10 border border-[#00ff9d] text-[#00ff9d] rounded-xl font-bold text-xs uppercase tracking-widest transition-all hover:bg-[#00ff9d] hover:text-black">
      Connect
    </button>
  </nav>

  <div class="raydium-card w-full max-w-[440px] p-6 shadow-2xl mt-12">
    <div class="flex justify-between items-center mb-6">
      <h2 class="font-bold text-xl">Swap</h2>
      <div class="flex gap-2">
        <span class="text-[10px] bg-black/40 px-2 py-1 rounded border border-white/10">0.5%</span>
      </div>
    </div>

    <div class="token-box p-4 rounded-2xl mb-1">
      <div class="flex justify-between text-xs text-white/40 mb-3 font-bold uppercase tracking-tighter">
        <span>From</span>
        <span id="from-bal">Bal: 0</span>
      </div>
      <div class="flex items-center justify-between gap-4">
        <div class="flex flex-col gap-1 flex-1">
          <input id="from-amount" type="number" placeholder="0.0" class="bg-transparent text-2xl font-bold outline-none text-white w-full"/>
          <span class="text-[10px] text-white/20">~$0.00</span>
        </div>
        <div class="flex flex-col items-end">
          <input id="from-ca" type="text" placeholder="Paste CA" class="bg-black/40 text-[10px] p-1 rounded border border-white/5 outline-none mb-1 w-24 text-center text-[#00ff9d]"/>
          <div class="flex items-center gap-2 bg-black/40 p-2 rounded-xl border border-white/10">
             <span id="from-symbol" class="font-bold text-sm">SOL</span>
          </div>
        </div>
      </div>
    </div>

    <div class="flex justify-center -my-3 relative z-10">
      <button id="switch-btn" class="switch-btn bg-[#131a1a] border border-white/10 p-2 rounded-lg transition-transform duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
        </svg>
      </button>
    </div>

    <div class="token-box p-4 rounded-2xl mt-1 mb-6">
      <div class="flex justify-between text-xs text-white/40 mb-3 font-bold uppercase tracking-tighter">
        <span>To</span>
        <span id="to-bal">Bal: 0</span>
      </div>
      <div class="flex items-center justify-between gap-4">
        <div class="flex flex-col gap-1 flex-1">
          <input id="to-amount" type="text" placeholder="0.0" readonly class="bg-transparent text-2xl font-bold outline-none text-white/40 w-full"/>
          <span class="text-[10px] text-white/20">~$0.00</span>
        </div>
        <div class="flex flex-col items-end">
          <input id="to-ca" type="text" placeholder="Paste CA" class="bg-black/40 text-[10px] p-1 rounded border border-white/5 outline-none mb-1 w-24 text-center text-[#00ff9d]"/>
          <div class="flex items-center gap-2 bg-black/40 p-2 rounded-xl border border-white/10">
             <span id="to-symbol" class="font-bold text-sm uppercase">USDC</span>
          </div>
        </div>
      </div>
    </div>

    <button id="swap-btn" disabled class="w-full py-4 bg-[#00ff9d] text-black font-black rounded-2xl uppercase tracking-[0.2em] transition-all disabled:opacity-20 hover:shadow-[0_0_20px_rgba(0,255,157,0.4)]">
      Connect Wallet
    </button>
    
    <div id="status" class="mt-4 text-[9px] text-center font-bold text-white/30 uppercase tracking-widest"></div>
  </div>

  <script>
    const JUP_API = 'https://quote-api.jup.ag/v6';
    const RPC = 'https://api.mainnet-beta.solana.com';
    let walletPK = null;
    let provider = null;
    let quote = null;

    // Token States
    let tokens = {
      from: { mint: 'So11111111111111111111111111111111111111112', symbol: 'SOL', decimals: 9 },
      to: { mint: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v', symbol: 'USDC', decimals: 6 }
    };

    // 1. Fitur Bolak Balik (Switch)
    document.getElementById('switch-btn').onclick = () => {
      const temp = { ...tokens.from };
      tokens.from = { ...tokens.to };
      tokens.to = temp;
      updateUI();
      getQuote();
    };

    function updateUI() {
      document.getElementById('from-symbol').textContent = tokens.from.symbol;
      document.getElementById('to-symbol').textContent = tokens.to.symbol;
      document.getElementById('from-ca').value = tokens.from.mint === 'So11111111111111111111111111111111111111112' ? '' : tokens.from.mint;
      document.getElementById('to-ca').value = tokens.to.mint === 'So11111111111111111111111111111111111111112' ? '' : tokens.to.mint;
      refreshBalances();
    }

    // 2. Fitur Paste Contract Address (CA)
    async function handleCAPaste(type, ca) {
      if (ca.length < 32) return;
      try {
        const res = await fetch(`https://token-list_api.solana.com/v1/mints/${ca}`); // Example or check Jup
        // For simplicity, we use Jupiter price API to validate
        const meta = await fetch(`https://api.jup.ag/price/v2?ids=${ca}`);
        const data = await meta.json();
        
        if (data.data[ca]) {
          tokens[type].mint = ca;
          tokens[type].symbol = 'TOKEN'; // You can fetch real symbol via Metaplex if needed
          updateUI();
          getQuote();
        }
      } catch (e) { console.log("CA not found"); }
    }

    document.getElementById('from-ca').oninput = (e) => handleCAPaste('from', e.target.value);
    document.getElementById('to-ca').oninput = (e) => handleCAPaste('to', e.target.value);

    // 3. Connect Wallet
    document.getElementById('connect-btn').onclick = async () => {
      if (walletPK) { logout(); return; }
      provider = window.solana || window.solflare;
      if (!provider) return alert("Install Wallet");
      const resp = await provider.connect();
      walletPK = resp.publicKey.toString();
      
      document.getElementById('connect-btn').textContent = `${walletPK.slice(0,4)}...${walletPK.slice(-4)}`;
      document.getElementById('swap-btn').textContent = "Swap";
      document.getElementById('swap-btn').disabled = false;
      refreshBalances();
    };

    function logout() {
      walletPK = null;
      document.getElementById('connect-btn').textContent = "Connect";
      document.getElementById('swap-btn').textContent = "Connect Wallet";
      document.getElementById('swap-btn').disabled = true;
    }

    async function refreshBalances() {
      if (!walletPK) return;
      const conn = new solanaWeb3.Connection(RPC);
      const pk = new solanaWeb3.PublicKey(walletPK);
      
      // Native SOL check
      if (tokens.from.mint.startsWith('So11')) {
        const bal = await conn.getBalance(pk);
        document.getElementById('from-bal').textContent = `Bal: ${(bal/1e9).toFixed(3)}`;
      }
    }

    async function getQuote() {
      const amt = document.getElementById('from-amount').value;
      if (!amt || amt <= 0) return;
      
      document.getElementById('status').textContent = "GETTING QUOTE...";
      try {
        const res = await fetch(`${JUP_API}/quote?inputMint=${tokens.from.mint}&outputMint=${tokens.to.mint}&amount=${Math.floor(amt * Math.pow(10, tokens.from.decimals))}&slippageBps=50`);
        quote = await res.json();
        document.getElementById('to-amount').value = (quote.outAmount / Math.pow(10, tokens.to.decimals)).toFixed(4);
        document.getElementById('status').textContent = "READY";
      } catch (e) { document.getElementById('status').textContent = "QUOTE ERROR"; }
    }

    document.getElementById('from-amount').oninput = getQuote;

    // 4. Execution
    document.getElementById('swap-btn').onclick = async () => {
      if (!walletPK || !quote) return;
      document.getElementById('status').textContent = "SIGNING...";
      try {
        const res = await fetch(`${JUP_API}/swap`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ quoteResponse: quote, userPublicKey: walletPK, wrapAndUnwrapSol: true })
        });
        const { swapTransaction } = await res.json();
        const txBuf = Uint8Array.from(atob(swapTransaction), c => c.charCodeAt(0));
        const tx = solanaWeb3.VersionedTransaction.deserialize(txBuf);
        const signed = await provider.signTransaction(tx);
        const conn = new solanaWeb3.Connection(RPC);
        const txid = await conn.sendRawTransaction(signed.serialize());
        document.getElementById('status').innerHTML = `<a href="https://solscan.io/tx/${txid}" target="_blank" class="underline">SUCCESS! VIEW TX</a>`;
      } catch (e) { document.getElementById('status').textContent = "FAILED"; }
    };
  </script>
</body>
</html>


 
